{% extends 'base.html.twig' %}

{% block title %}Mon entreprise{% endblock %}

{% block body %}

    <section id="company" class="mt-3">
        <div class="container-mvp">
            <div class="row">
                <div class="col-lg-4 col-md-12">
                    <div class="box-image company-image">
                        {% if company.logo is empty %}
                            <img class="company-no-available-img" src="/images/no-available-company-photo.png" class="img-fluid" alt="">
                        {% else %}
                            <img src="/images/logos/{{ company.logo }}" class="img-fluid" alt="">
                        {% endif %}
                    </div>

                    <div class="box company-informations">
                        {% if company.category %}
                          <p><i class="fa fa-tags margin-r-10" aria-hidden="true"></i> {{ company.category.name }}</p>
                        {% endif %}
                        <p><i class="fa fa-envelope-o margin-r-10" aria-hidden="true"></i> {{ company.email }}</p>
                        {% if company.isCompleted %}
                            <p class="company-tel"><i class="fa fa-phone margin-r-10" aria-hidden="true"></i>{{ company.phone }}</p>
                            <p class="company-tel"><i class="fa fa-map-marker margin-r-10" aria-hidden="true"></i> {{ company.addressNumber }} {{ company.addressStreet }} {{ company.addressPostCode }}</p>
                        {% endif %}
                        {% if company.website %}
                          <p class="company-tel"><i class="fa fa-globe margin-r-10" aria-hidden="true"></i>{{ company.website }}</p>
                        {% endif %}
                    </div>

                    <div class="box store-informations">
                        <h4>Mon magasin Bureau Vallée</h4>
                        <p>{{ company.store.introduction ?: 'Pas d\'introduction'}}</p>
                    </div>
                </div>

                <div class="col-lg-8 col-md-12">
                    <div class="box">
                        <div class="row">
                            <div class="col-8">
                                <div class="info-company">
                                    <h2>{{ company.name }}</h2>
                                    <p class="lead">{{ company.introduction }}</p>
                                    <p>{{ company.description }}</p>
                                </div>
                            </div>
                            <div class="col-4 text-right">
                                {% if is_granted('ROLE_ADMIN_COMPANY') and company.id == app.user.company.id %}
                                    <a href="{{ path('company_edit', {'id': company.id}) }}" class="btn btn-design btn-2 p-3"><i class="fa fa-pencil margin-r-10" aria-hidden="true"></i>Editer mon entreprise</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="box">
                        <h4 class="mb-4">{{ countServices }} Services Bureau Vallée</h4>
                        {% if services %}
                            <div class="row">
                                {% for service in services %}
                                    <div class="col-lg-4 col-md-6">
                                        <div class="box card">
                                            <a href="{{ path('service_show', {'id': service.id}) }}">
                                                <div class="portfolio-wrap dashboard-service-image">
                                                    {% if service.filename %}
                                                        <img src="{{ vich_uploader_asset(service, 'imageFile') }}" class="img-fluid" alt="">
                                                    {% else %}
                                                        <img src="/images/default/unknown_bg.png" class="img-fluid" alt="">
                                                    {% endif %}
                                                </div>
                                                <div class="info">
                                                    <h4 class="title preview">{{ service.title }}</h4>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-muted">Aucun service pour l'instant</p>
                        {% endif %}

                        <p><a href="{{ path('service_company', {'company': company.id}) }}" type="button" class="btn btn-md btn-2 full-width">Voir tous les services de {{ company.name|capitalize }} </a></p>
                    </div>

                    <div class="box">
                       <h4 class="mb-3">Contacts</h4>
                       {% if users %}
                          {%  for user in users %}
                              {% if user.profile.isCompleted %}
                               <div class="col-lg-4 col-md-6 wow bounceInUp" data-wow-duration="1.4s">
                                   <div class="box">
                                      <div class="portfolio-wrap dashboard-service-image company-contact-img">
                                          <a class="user-link" href="{{path('profile_show', { 'id': user.profile.id}) }}">
                                              {% if user.profile.filename is empty %}
                                                <img class ="img-fluid contact-no-available-img"src="/images/no-available-photo.png" class="img-fluid sm-profile-img" alt="">

                                              {% else %}
                                                <img src="{{ vich_uploader_asset(user.profile, 'imageFile') }}" class="img-fluid" alt="">

                                              {% endif %}

                                          </a>
                                      </div>
                                       <div class="user-information">
                                           <p class="company-user">
                                               <a class="company-user" href="{{path('profile_show', { 'id': user.profile.id}) }}">
                                                 {{ user.profile.firstname|capitalize }} {{ user.profile.lastname|capitalize }}
                                               </a>
                                           </p>
                                           {% if user.profile.function  %}
                                             <p class="company-user-job">{{ user.profile.function.name|capitalize }}</p>
                                           {% endif %}
                                           <p class="user-contact">
                                               <span class="user-action btn-radius"><a class="user-link" href="{{ path('chat_private', {'id': user.id}) }}">Contacter</a></span>
                                               <span class="user-action btn-radius"><a class="user-link" href="{{path('profile_show', { 'id': user.profile.id}) }}">Voir fiche</a></span>
                                           </p>
                                       </div>
                                   </div>
                               </div>
                              {% endif %}
                          {% endfor %}
                       {% endif %}
                    </div>


                    <div class="box">
                        <div class="row">
                            <div class="col-6">
                                <h4>Recommandations</h4>
                            </div>
                            <div class="col-6 text-right">
                                {% if company.id != app.user.company.id and app.user.profile.isCompleted == true %}
                                    <a href="#" type="button"
                                            class="add-recommandation btn btn-sm btn-2"
                                            data-toggle="modal"
                                            data-target="{{ path('recommandation') }}"
                                            data-whatever="@getbootstrap"
                                            data-company="{{company.id}}">
                                        <i class="fa fa-thumbs-up"></i> Proposer une recommandation
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        {% if recommandations %}
                            {% for recommandation in recommandations %}
                                <div class="recommandation">
                                    <div class="avatar">
                                        {% if recommandation.user.profile.filename %}
                                            <img src="{{ vich_uploader_asset(recommandation.user.profile, 'imageFile') }}" class="img-fluid" alt="">
                                        {% else %}
                                            <img src="/images/default/user.png" class="img-fluid" alt="">
                                        {% endif %}
                                    </div>
                                    <div class="content p-2">
                                        <p><strong>{{recommandation.user.profile.lastname|capitalize }} {{recommandation.user.profile.firstname|capitalize }}</strong></p>
                                        <p class="text-muted">{{recommandation.message }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            {#<p class="text-muted">Aucune recommandation pour l'instant</p>#}
                            <div class="company-recommandation">
                                {%  set emptyData = 'Aucun recommandation n\'a été trouvé' %}
                                {%  include 'default/no-data.html.twig'  %}
                            </div>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>
    </section>
      
{% endblock %}
{% block modals %}
    <div class="modal fade" id="recommandation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                {% include 'default/spinner.html.twig' %}
            </div>
        </div>
    </div>
{% endblock %}
