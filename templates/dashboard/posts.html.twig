<div class="posts">
  {% for message in app.flashes('create-post-success') %}
  <div class="alert alert-success">
    {{ message }}
  </div>
{% endfor %}

  {% for post in posts %}
      {% set difference = date(post.createdAt|date('Y/m/d')).diff(date('now'|date('Y/m/d'))) %}
      {% set leftDays = difference.days %}
      {% set days = difference.days %}
      {% if leftDays == 0 %}
      {% set leftDays = post.createdAt|date("h:m") %}
      {% elseif leftDays == 1 %}
      {% set leftDays =  '1 jour' %}
      {% else %}
      {% set leftDays =  leftDays ~ ' jours' %} 
      {% endif %}
      {% if post.status != 1%}
      <div id="post-id-{{post.id}}" class="row post col-12 {% if (loop.index - 1) > 20 %} post-hidden {% endif %}" data-category= "{{post.category}}" data-post-pusblished={{days}}>
          <div class="user-profil-photo col-1">
              <div class="user-profil">
                  {% if post.user.profile.filename %}
                      {% set variable = post.user.profile.filename  %}
                      <a href="{{path('profile_show', { 'id': post.user.profile.id}) }}">
                          <img src="{{ asset('/images/profiles/'~ variable) | imagine_filter('thumbnail45') }}" class="user-profil-sm" alt="">
                      </a>
                  {% else %}
                      <a href="{{path('profile_show', { 'id': post.user.profile.id}) }}">
                          <img src="/images/default/user.png" class="user-profil-sm" alt="">
                      </a>
                  {% endif %}
              </div>
          </div>

          <div class="col-10">
              <div class="lead post-user-profile">
                  <strong class="post-user">
                      <a href="{{path('profile_show', { 'id': post.user.profile.id}) }}">
                        {{post.user.profile.firstname}} {{post.user.profile.lastname}}
                      </a>
                  </strong>
                  <strong class="post-created-at">{{leftDays}}</strong>
                  <p>
                      {% if  post.user.company %}
                          <a class="user-company-name" href="{{path('company_show', { 'slug': post.user.company.slug}) }}">
                              {{post.user.company.name|capitalize}}
                          </a>
                      {% endif %}
                  </p>
              </div>
              

              <div class="lead post-title"><b>{{post.title|capitalize}}</b></div>
              <div class="lead post-description">{{post.description}}</div>
              <div id = "post-{{post.id}}-likes-number" class="like-number" data-path="{{path('post_likes', { 'id': post.id})}}">
                {% if post.likesNumber > 0 %}
                    <span id="likes-list-{{post.id}}" 
                            class="post-likes" 
                            data-post="{{post.id}}" 
                            data-toggle="modal" 
                            data-target="#LikesList" 
                            data-whatever="@mdo"
                            data-path="{{path('post_likes', { 'id': post.id})}}">
                        <i id ="post-likes-icon-{{post.id}}" class="fa fa-thumbs-up mvp-color" aria-hidden="true"></i>
                        <span id ="post-likes-number-{{post.id}}" class="post-likes-number">
                          {{post.likesNumber}}</span>
                    </span>
                {% endif %}
                    <div class="modal fade LikesList" id="LikesList" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content modal-likes-list">
                                
                                <div class="modal-body">
                                    <div class="spinner-grow" style="width: 1rem; height: 1rem;" role="status">
                                        <span class="sr-only">Loading...</span>
                                      </div>
                                      <div class="spinner-grow" style="width: 1rem; height: 1rem;" role="status">
                                        <span class="sr-only">Loading...</span>
                                      </div>
                                      <div class="spinner-grow" style="width: 1rem; height: 1rem;" role="status">
                                        <span class="sr-only">Loading...</span>
                                      </div>
                                </div>
                                <div class="modal-footer">
                                
                                </div>
                            </div>
                        </div>
                    </div>
                  
                  <span><a id ="comments-button-{{post.id}}" class="comments-link" href="#" data-post-id = "{{post.id}}">
                      {% if post.commentsNumber > 0 %}
                        <span id="post-{{post.id}}-comments-number">{{post.commentsNumber}} </span> commentaire
                      {% endif %}
                  </a></span>
              </div>

                  {% if  app.user.profile.isCompleted == true %}
                        <div class="col-14">

                              {% if likedPost[loop.index - 1] == 1 %}
                                <button id = "like-button-{{post.id}}" type="button" class="btn btn-light btn-sm like-button post-liked post-btns" data-post-likes-number = "{{post.likesNumber}}" data-post-id = "{{post.id}}"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> J'aime</button>
                              {% else %}
                                <button id = "like-button-{{post.id}}" type="button" class="btn btn-light btn-sm like-button post-btns" data-post-likes-number = "{{post.likesNumber}}" data-post-id = "{{post.id}}"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> J'aime</button>
                              {% endif %}
                                <button id = "comment-button-{{post.id}}" type="button" class="btn btn-light btn-sm comment-button post-btns" data-post-id = {{post.id}}><i class="fa fa-commenting-o" aria-hidden="true"></i> Commenter</button>
                                <a href="{{ path('chat_private', {'id': post.user.id}) }}" id = "chat-button-{{post.id}}" type="button" class="btn btn-light btn-sm chat-button post-btns" data-post-id = {{post.id}}><i class="fa fa-comments-o" aria-hidden="true"></i> Chater avec l'auteur</a>
                              <!--<button id = "share-button-{{post.id}}" type="button" class="btn btn-light btn-sm share-button" data-post-id = {{post.id}}><i class="fa fa-retweet" aria-hidden="true"></i> Partager</button>-->

                        </div>
                          {% include 'dashboard/add-comment.html.twig' %}
                  {% endif %}

              {% include 'dashboard/comments.html.twig' %}
         </div>
          <div class="col-1 dropdown">
              <i class="fa fa-ellipsis-h post-action-icon" aria-hidden="true" data-toggle="dropdown" data-post="{{ post.id }}" aria-haspopup="true" aria-expanded="false"></i>

              <div id="post-actions-{{ post.id }}" class="post-actions" aria-labelledby="dropdownMenuButton">
                  {% include 'dashboard/post/post-delete.html.twig' %}
                  {% include 'dashboard/post/post-report-abuse.html.twig' %}
              </div>
          </div>
         
      </div>
      {% endif %}
  {% endfor %}
  {% if postNumber > 15 %}
      <div class="row">
          <button class="btn-shadow btn-wide btn-pill btn btn-focus btn-show-more">
              <span class="badge badge-dot badge-dot-lg badge-warning badge-pulse">Badge</span>
              Afficher plus de postes
          </button>
      </div>
  {% endif  %}
</div>